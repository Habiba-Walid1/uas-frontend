<div class="payroll-container">

<h1 class="page-title">
  {{ userRole === 'admin' ? 'Payroll Management Dashboard' : 'Staff Payroll Dashboard' }}
</h1>

  <div class="summary-row">
    <div class="card blue">
      <label>Total Staff</label>
      <h2>{{ staffList.length }}</h2>
    </div>

    <div class="card green">
      <label>Total Allowances</label>
      <h2>{{ totalAllowances | number }} EGP</h2>
    </div>

    <div class="card red">
      <label>Total Deductions</label>
      <h2>{{ totalDeductions | number }} EGP</h2>
    </div>

    <div class="card purple">
      <label>Total Net Payroll</label>
      <h2>{{ totalNet | number }} EGP</h2>
    </div>
  </div>

  <!-- Only Admins can Add -->
  <button *ngIf="userRole === 'admin'" class="add-btn" (click)="openModal()">+ Add Payroll Entry</button>

  <table class="payroll-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Base Salary</th>
        <th>Allowances</th>
        <th>Deductions</th>
        <th>Net Salary</th>
        <th>Invoice</th>
        <th *ngIf="userRole === 'admin'">Delete</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let s of staffList; let i = index">
        <td>{{ s.name }}</td>
        <td>{{ s.baseSalary }} EGP</td>
        <td>{{ s.allowances }} EGP</td>
        <td>{{ s.deductions }} EGP</td>
        <td class="bold">{{ s.net }} EGP</td>
        <td><span class="invoice-link" (click)="downloadInvoice(s)">Download</span></td>
        <td *ngIf="userRole === 'admin'">
          <button class="delete-btn" (click)="delete(i)">âœ•</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="chart-box">
    <canvas id="payrollChart"></canvas>
  </div>

  <!-- MODAL -->
  <div class="modal" *ngIf="modalOpen">
    <div class="modal-box">
      <h3>Add Payroll Entry</h3>

      <label>Employee Name</label>
      <input type="text" placeholder="Enter employee full name" [(ngModel)]="form.name">

      <label>Base Salary (EGP)</label>
      <input type="number" placeholder="ex: 12000" [(ngModel)]="form.baseSalary">

      <label>Allowances (EGP)</label>
      <input type="number" placeholder="ex: 1500" [(ngModel)]="form.allowances">

      <label>Deductions (EGP)</label>
      <input type="number" placeholder="ex: 300" [(ngModel)]="form.deductions">

      <div class="modal-actions">
        <button class="primary" (click)="save()">Save</button>
        <button class="secondary" (click)="closeModal()">Cancel</button>
      </div>
    </div>
  </div>

</div>
