<div class="fees-page">

  <h1 class="title">
    {{ userRole === 'admin' ? 'Fees Management Dashboard' : 'Student Fees Overview' }}
  </h1>

  <!-- Admin summary -->
  <div *ngIf="userRole==='admin'" class="admin-summary">
    <div class="summary-card">
      <label>Total Outstanding</label>
      <h2>{{ outstanding | number }} EGP</h2>
    </div>
    <div class="summary-card">
      <label>Total Collected</label>
      <h2>{{ totalCollected | number }} EGP</h2>
    </div>
  </div>

  <!-- Admin Search Bar -->
  <div *ngIf="userRole==='admin'" class="search-bar">
    <input type="text" [(ngModel)]="searchText" placeholder="Search by student or fee name..." />
    <button (click)="search()">Search</button>
  </div>

  <!-- Student Outstanding -->
  <p *ngIf="userRole==='student'" class="subtitle">
    Outstanding Balance: <strong>{{ outstanding | number }} EGP</strong>
  </p>

  <!-- Table -->
  <div class="table-wrapper">
    <table class="fees-table">
      <thead>
        <tr>
          <th *ngIf="userRole==='admin'">Student</th>
          <th>Fee Name</th>
          <th>Amount</th>
          <th>Due Date</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let fee of filteredFees">
          <td *ngIf="userRole==='admin'">{{ fee.student }}</td>
          <td>{{ fee.name }}</td>
          <td>{{ fee.amount | number }} EGP</td>
          <td>{{ fee.dueDate }}</td>
          <td>
            <span class="status" [class.paid]="fee.status==='PAID'" [class.unpaid]="fee.status==='UNPAID'">
              {{ fee.status }}
            </span>
          </td>
          <td class="actions">
            <button *ngIf="userRole==='student' && fee.status==='UNPAID'" (click)="openPayment(fee)">Pay</button>
            <button *ngIf="fee.status==='PAID'" class="invoice-btn" (click)="downloadInvoice(fee)">Invoice</button>

            <button *ngIf="userRole==='admin' && fee.status==='UNPAID'" class="mark-btn green" (click)="markPaid(fee)">Mark Paid</button>
            <button *ngIf="userRole==='admin' && fee.status==='PAID'" class="mark-btn yellow" (click)="markUnpaid(fee)">Mark Unpaid</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- PAYMENT MODAL -->
<div class="modal" *ngIf="paying">
  <div class="modal-box">
    <h2>Pay {{ selectedFee?.name }}</h2>

    <label>Card Holder Name</label>
    <input [(ngModel)]="cardName" placeholder="John Doe">

    <label>Card Number</label>
    <input [(ngModel)]="cardNumber" placeholder="xxxx xxxx xxxx xxxx">

    <label>CVV</label>
    <input [(ngModel)]="cardCVV" placeholder="xxx">

    <div class="modal-actions">
      <button class="pay-btn" (click)="confirmPayment()">Confirm Payment</button>
      <button class="cancel-btn" (click)="closeModal()">Cancel</button>
    </div>
  </div>
</div>
